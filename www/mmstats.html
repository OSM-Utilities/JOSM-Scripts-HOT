
<html>
  <head>
<title>mmstats</title>

  </head>
<body>
  <h1>mmstats</h1>
  <script src="../lib/jquery.js"></script>
  <script src="../lib/mmstats.js"></script>

<div id="getInput"
<p>Type in hashtags (omit #, comma-separated):</p>
<input type="text" id ="hashtag" style="width:50%"> </br>
<p>Type in a start time (format yyyy-mm-dd_hh:mm:ss):</p>
<input type="text" id ="from"  value=""> </br>
<input type="button" value="Now" id="now" >
<p>Type in an end time (format yyyy-mm-dd_hh:mm:ss):</p>
<input type="text" id="to" value=""> </br>
<p>Type in a user ID:</p>
<input type="text" id="user" value=""> </br>
</br>

<input type="button" value="Submit" id="submit" >
<input type="button" value="Bookmark this query" id="query" >
</div>

<a id="link" style="display: none;" target="_blank"> Link </a>

<div id="output">
</div>

<script>
    var parsed = getUrlVars();
	var parameters = ["hashtag","from","to","user"]; 
	for (var i = 0; i < parameters.length; i++) {
        if (parsed[parameters[i]] != undefined){
		    document.getElementById(parameters[i]).value = parsed[parameters[i]];
		}
    }

  $(document).ready(function(){
    $('#submit').click(function(){
	   var user = document.getElementById("user").value;
	   var hashtag = document.getElementById("hashtag").value;
	   var array = hashtag.split(',');
	   var from = document.getElementById("from").value;
	   var to = document.getElementById("to").value;
	   from = from.split("_");
	   to = to.split("_");
	   from = from[0] + "T" + from[1] + "Z";
			    to = to[0] + "T" + to[1] + "Z";
			    var userarr = []; 
			    if (user !== "") {
//TODO - userarr needs to be set to array derived from user
			    userarr = [user];
			    };
	   consolelog("");
	   analyse(userarr,array,from,to);
    });
  });
  
  $(document).ready(function()
      {  
        $("#query").click(function() {
		var hashtag = document.getElementById("hashtag").value;
		var from = document.getElementById("from").value;
		var to = document.getElementById("to").value;
		var user = document.getElementById("user").value;
		var url = "mmstats.html?hashtag="+hashtag+"&from="+from+"&to="+to+"&user="+user;
		document.getElementById("link").setAttribute("href",url);
         $("#link").toggle()
         });  
       });   
	   
  $(document).ready(function()
      {  
        $("#now").click(function() {
		var currentdate = new Date();
		currentdate.toISOString().substring(0, 10);
		var datetime = setCorrectTime(currentdate);
		document.getElementById("from").value = datetime;
		
		var currentdate = new Date();
		currentdate.setHours(currentdate.getHours() + 3);
		currentdate.toISOString().substring(0, 10);
		var datetime = setCorrectTime(currentdate);
		document.getElementById("to").value = datetime;
         });  
       });      

  function consolelog(string) {
  var e = document.getElementById("output");
  var out = string.replace(/\[(\S+)\]/gi, "<a href=\"www.openstreetmap.org/$1\">$1</a>");
  // Instead of creating a text node, use the html...			    
  e.append(document.createTextNode(out) );
  e.append(document.createElement('br'));
  };

</script>

<address>
</address>
</body>
</html>
